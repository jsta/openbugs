<!DOCTYPE html PUBLIC "-//W3C//DTD Html 1.0 Strict//EN" "http://www.w3.org/TR/Html1/DTD/strict.dtd"><html><head><title>Schools</title></head><body><p><font face="Arial" color="#000100" size="2"></font><font face="Arial" color="#000100" size="3"><strong><img src="schools0.bmp" alt="[schools0]"></strong></font><font face="Arial" color="#0000FF" size="5"><strong>&nbsp;&nbsp;&nbsp;</strong></font><font face="Courier New" color="#000100" size="6">Schools: ranking schoolexamination<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;results using multivariate<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hierarcical models</font><font face="Arial" color="#0000FF" size="5"><strong><br></strong></font><font face="Arial" color="#0000FF" size="2"><strong><br></strong></font><font face="Arial" color="#000100" size="3">Goldstein et al. (1993) present an analysis of examination results from inner London schools. They use hierarchical or multilevel models to study the between-school variation, and calculate school-level residuals in an attempt to differentiate between `good' and `bad' schools. Here we analyse a subset of this data and show how to calculate a rank ordering of schools and obtain credible intervals on each rank.<br><br></font><font face="Arial" color="#000100" size="3"><em>Data</em></font><font face="Arial" color="#000100" size="3"><br><br>Standardized mean examination scores (Y) were available for 1978 pupils from 38 different schools. The median number of pupils per school was 48, with a range of 1--198. Pupil-level covariates included gender plus a standardized London Reading Test (LRT) score and a verbal reasoning (VR) test category (1, 2 or 3, where 1 represents the highest ability group) measured when each child was aged 11. Each school was classified by gender intake (all girls, all boys or mixed) and denomination (Church of England, Roman Catholic, State school or other); these were used as categorical school-level covariates.<br><br></font><font face="Arial" color="#000100" size="3"><em>Model</em></font><font face="Arial" color="#000100" size="3"><br><br>We consider the following model, which essentially corresponds to Goldstein et al.'s model 1. <br><br><br>&nbsp;&nbsp;&nbsp;Y</font><font face="Arial" color="#000100" size="2"><sub>ij</sub></font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;~&nbsp;&nbsp;&nbsp;Normal(</font><font face="Symbol" color="#000100" size="3">m</font><font face="Arial" color="#000100" size="2"><sub>ij</sub></font><font face="Arial" color="#000100" size="3">, </font><font face="Symbol" color="#000100" size="3">t</font><font face="Arial" color="#000100" size="2"><sub>ij</sub></font><font face="Arial" color="#000100" size="3">)<br>&nbsp;&nbsp;&nbsp;</font><font face="Symbol" color="#000100" size="3">m</font><font face="Arial" color="#000100" size="2"><sub>ij</sub></font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;</font><font face="Symbol" color="#000100" size="3">a</font><font face="Arial" color="#000100" size="2"><sub>1j</sub></font><font face="Arial" color="#000100" size="3"> + </font><font face="Symbol" color="#000100" size="3">a</font><font face="Arial" color="#000100" size="2"><sub>2j</sub></font><font face="Arial" color="#000100" size="3"> LRT</font><font face="Arial" color="#000100" size="2"><sub>ij</sub></font><font face="Arial" color="#000100" size="3"> + </font><font face="Symbol" color="#000100" size="3">a</font><font face="Arial" color="#000100" size="3"><sub>3j</sub></font><font face="Arial" color="#000100" size="3"> VR</font><font face="Arial" color="#000100" size="2">1</font><font face="Arial" color="#000100" size="2"><sub>ij</sub></font><font face="Arial" color="#000100" size="3"> + </font><font face="Symbol" color="#000100" size="3">b</font><font face="Arial" color="#000100" size="2"><sub>1</sub></font><font face="Arial" color="#000100" size="3"> LRT</font><font face="Arial" color="#000100" size="2"><sub>ij</sub></font><font face="Arial" color="#000100" size="2"><sup>2</sup></font><font face="Arial" color="#000100" size="3"> + </font><font face="Symbol" color="#000100" size="3">b</font><font face="Arial" color="#000100" size="2"><sub>2</sub></font><font face="Arial" color="#000100" size="3"> VR</font><font face="Arial" color="#000100" size="2">2</font><font face="Arial" color="#000100" size="2"><sub>ij</sub></font><font face="Arial" color="#000100" size="3"> + </font><font face="Symbol" color="#000100" size="3">b</font><font face="Arial" color="#000100" size="2"><sub>3</sub></font><font face="Arial" color="#000100" size="3"> Girl</font><font face="Arial" color="#000100" size="2"><sub>ij</sub></font><font face="Arial" color="#000100" size="3"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ </font><font face="Symbol" color="#000100" size="3">b</font><font face="Arial" color="#000100" size="2"><sub>4</sub></font><font face="Arial" color="#000100" size="3"> Girls' school</font><font face="Arial" color="#000100" size="2"><sub>j</sub></font><font face="Arial" color="#000100" size="3"> + </font><font face="Symbol" color="#000100" size="3">b</font><font face="Arial" color="#000100" size="2"><sub>5</sub></font><font face="Arial" color="#000100" size="3"> Boys' school</font><font face="Arial" color="#000100" size="2"><sub>j</sub></font><font face="Arial" color="#000100" size="3"> + </font><font face="Symbol" color="#000100" size="3">b</font><font face="Arial" color="#000100" size="2"><sub>6</sub></font><font face="Arial" color="#000100" size="3"> CE school</font><font face="Arial" color="#000100" size="2"><sub>j</sub></font><font face="Arial" color="#000100" size="3"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ </font><font face="Symbol" color="#000100" size="3">b</font><font face="Arial" color="#000100" size="2"><sub>7</sub></font><font face="Arial" color="#000100" size="3"> RC school</font><font face="Arial" color="#000100" size="2"><sub>j</sub></font><font face="Arial" color="#000100" size="3"> + </font><font face="Symbol" color="#000100" size="3">b</font><font face="Arial" color="#000100" size="2"><sub>8</sub></font><font face="Arial" color="#000100" size="3"> other school</font><font face="Arial" color="#000100" size="2"><sub>j</sub></font><font face="Arial" color="#000100" size="3"><br>&nbsp;&nbsp;&nbsp;log </font><font face="Symbol" color="#000100" size="3">t</font><font face="Arial" color="#000100" size="2"><sub>ij</sub></font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;</font><font face="Symbol" color="#000100" size="3">q</font><font face="Arial" color="#000100" size="3"> + </font><font face="Symbol" color="#000100" size="3">f</font><font face="Arial" color="#000100" size="3"> LRT</font><font face="Arial" color="#000100" size="2"><sub>ij</sub></font><font face="Arial" color="#000100" size="3"><sub><br></sub></font><font face="Arial" color="#000100" size="3"><br>where i refers to pupil and j indexes school. We wish to specify a regression model for the variance components, and here we model the logarithm of </font><font face="Symbol" color="#000100" size="3">t</font><font face="Arial" color="#000100" size="2"><sub>ij</sub></font><font face="Arial" color="#000100" size="3"> (the inverse of the between-pupil variance) as a linear function of each pupil's LRT score. This differs from Goldstein et al.'s model which allows the</font><font face="Arial" color="#000100" size="3"><em> variance </em></font><font face="Symbol" color="#000100" size="3">s</font><font face="Arial" color="#000100" size="2"><sup>2</sup></font><font face="Arial" color="#000100" size="2"><sub>ij</sub></font><font face="Arial" color="#000100" size="3"> to depend linearly on LRT. However, such a parameterization may lead to negative estimates of </font><font face="Symbol" color="#000100" size="3">s</font><font face="Arial" color="#000100" size="2"><sup>2</sup></font><font face="Arial" color="#000100" size="2"><sub>ij</sub></font><font face="Arial" color="#000100" size="3">.<br><br></font><font face="Arial" color="#000100" size="3"><em>Prior distributions</em></font><font face="Arial" color="#000100" size="3"><br><br>The fixed effects </font><font face="Symbol" color="#000100" size="3">b</font><font face="Arial" color="#000100" size="2"><sub>k</sub></font><font face="Arial" color="#000100" size="3"> (k=1,...,8), </font><font face="Symbol" color="#000100" size="3">q</font><font face="Arial" color="#000100" size="3"> and</font><font face="Symbol" color="#000100" size="3"> f</font><font face="Arial" color="#000100" size="3"> were assumed to follow vague independent Normal distributions with zero mean and low precision = 0.0001. The random school-level coefficients </font><font face="Symbol" color="#000100" size="3">a</font><font face="Arial" color="#000100" size="2"><sub>kj</sub></font><font face="Arial" color="#000100" size="3"> (k = 1,2,3) were assumed to arise from a multivariate normal population distribution with unknown mean </font><font face="Symbol" color="#000100" size="3"><strong>g</strong></font><font face="Arial" color="#000100" size="3"> and covariance matrix </font><font face="Symbol" color="#000100" size="3"><strong>S</strong></font><font face="Arial" color="#000100" size="3">. A non-informative multivariate normal prior was then specified for the population mean </font><font face="Symbol" color="#000100" size="3"><strong>g</strong></font><font face="Arial" color="#000100" size="3">, whilst the inverse covariance matrix </font><font face="Symbol" color="#000100" size="3"><strong>T</strong></font><font face="Arial" color="#000100" size="3"> = </font><font face="Symbol" color="#000100" size="3"><strong>S</strong></font><font face="Arial" color="#000100" size="2"><sup>-1</sup></font><font face="Arial" color="#000100" size="3"> was assumed to follow a Wishart distribution. To represent vague prior knowledge, we chose the degrees of freedom for this distribution to be as small as possible (i.e. 3, the rank of </font><font face="Symbol" color="#000100" size="3"><strong>T</strong></font><font face="Arial" color="#000100" size="3">). The scale matrix </font><font face="Arial" color="#000100" size="3"><strong>R</strong></font><font face="Arial" color="#000100" size="3"> was specified as<br><center><br></font><font face="Arial" color="#000100" size="2"><img src="schools1.bmp" alt="[schools1]"><br></center></font><font face="Arial" color="#000100" size="3"><br>which represents our prior guess at the order of magnitude of </font><font face="Symbol" color="#000100" size="3"><strong>S</strong></font><font face="Arial" color="#000100" size="3">.<br><br>The BUGS code is given below:<br><br></font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;model<br>&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(p in 1 : N) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Y[p] ~ dnorm(mu[p], tau[p])<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mu[p] &lt;- alpha[school[p], 1] + alpha[school[p], 2] * LRT[p] <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ alpha[school[p], 3] * VR[p, 1] + beta[1] * LRT2[p] <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ beta[2] * VR[p, 2] + beta[3] * Gender[p] <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ beta[4] * School.gender[p, 1] + beta[5] * School.gender[p, 2]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ beta[6] * School.denom[p, 1] + beta[7] * School.denom[p, 2]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ beta[8] * School.denom[p, 3]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log(tau[p]) &lt;- theta + phi * LRT[p]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sigma2[p] &lt;- 1 / tau[p]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LRT2[p] &lt;- LRT[p] * LRT[p]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min.var &lt;- exp(-(theta + phi * (-34.6193))) # lowest LRT score = -34.6193<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max.var &lt;- exp(-(theta + phi * (37.3807))) # highest LRT score = 37.3807<br><br>&nbsp;&nbsp;&nbsp;# Priors for fixed effects:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (k in 1 : 8) { <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;beta[k] ~ dnorm(0.0, 0.0001) <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;theta ~ dnorm(0.0, 0.0001)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;phi ~ dnorm(0.0, 0.0001)<br><br>&nbsp;&nbsp;&nbsp;# Priors for random coefficients:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (j in 1 : M) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alpha[j, 1 : 3] ~ dmnorm(gamma[1:3 ], T[1:3 ,1:3 ]); <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alpha1[j] &lt;- alpha[j,1]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;# Hyper-priors:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gamma[1 : 3] ~ dmnorm(mn[1:3 ], prec[1:3 ,1:3 ]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T[1 : 3, 1 : 3 ] ~ dwish(R[1:3 ,1:3 ], 3)<br>&nbsp;&nbsp;&nbsp;}<br><br></font><font face="Arial" color="#000100" size="1"><br></font><font face="Arial" color="#0000FF" size="5"><a href="../Examples/Schoolsdata.html"></font><font face="Arial" color="#0000FF" size="5"><u>Data</u></font><font face="Arial" color="#0000FF" size="5"></a> </font><font face="Arial" color="#000100" size="3">( click to open )</font><font face="Arial" color="#000100" size="1"><br><br></font><font face="Arial" color="#000100" size="3">Note that </font><font face="Courier" color="#000100" size="3">school</font><font face="Arial" color="#000100" size="3"> is a 1978 x 3 matrix taking value 1 for all pupils in school 1, 2 for all pupils in school 2 and so on. For computational convenience, </font><font face="Courier" color="#000100" size="3">Y</font><font face="Arial" color="#000100" size="3">, </font><font face="Courier" color="#000100" size="3">mu</font><font face="Arial" color="#000100" size="3"> and </font><font face="Courier" color="#000100" size="3">tau</font><font face="Arial" color="#000100" size="3"> are indexed over a single dimension </font><font face="Courier" color="#000100" size="3">p</font><font face="Arial" color="#000100" size="3"> = 1,...,1978 rather than as pupil i within school j as used in equations above. The appropriate school-level coefficients for pupil </font><font face="Courier" color="#000100" size="3">p</font><font face="Arial" color="#000100" size="3"> are then selected using the school indicator in row </font><font face="Courier" color="#000100" size="3">p</font><font face="Arial" color="#000100" size="3"> of the data array --- for example </font><font face="Courier" color="#000100" size="3">alpha[school[p],1]</font><font face="Arial" color="#000100" size="3">. </font><font face="Arial" color="#0000FF" size="3"><br></font><font face="Arial" color="#0000FF" size="5"><br><a href="../Examples/Schoolsinits.html"></font><font face="Arial" color="#0000FF" size="5"><u>Inits&nbsp;for&nbsp;chain&nbsp;1</a></u></font><font face="Arial" color="#000100" size="3"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#0000FF" size="5"><a href="../Examples/Schoolsinits1.html"></font><font face="Arial" color="#0000FF" size="5"><u>Inits&nbsp;for&nbsp;chain&nbsp;2</a></u></font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;( click to open )</font><font face="Arial" color="#0000FF" size="5"><br></font><font face="Arial" color="#000100" size="1"><br></font><font face="Arial" color="#0000FF" size="5">Results</font><font face="Arial" color="#000100" size="5"> <br></font><font face="Arial" color="#000100" size="3"><br></font><font face="Arial" color="#000000" size="3">A 1000 update burn in followed by a further 10000 updates gave the parameter estimates <br><center><br></font><font face="Arial" color="#000100" size="3"><br></font><font face="Arial" color="#000100" size="1"><br><img src="schools2.bmp" alt="[schools2]"><br><br></font><font face="Arial" color="#000100" size="3"><em></center>Estimating the ranks</em></font><font face="Arial" color="#000100" size="3"><br><br>The school-specific intercept </font><font face="Symbol" color="#000100" size="3">a</font><font face="Arial" color="#000100" size="3"><sub>j1</sub></font><font face="Arial" color="#000100" size="3"> measures the 'residual effect' for school j after adjusting for pupil- and school-level covariates. This might represent an appropriate quantity by which to rank schools' performance. We compute the ranks in BUGS using the &quot;rank&quot; option of the &quot;Statistics&quot; menu, which we set for the variable alpha at the same time as we set the &quot;sample monitor&quot; option. Since the rank is a function of stochastic nodes, its value will change at every iteration. Hence we may obtain a posterior distribution for the rank of alpha[, k] which may be summarized by posterior histograms as shown below: </font></p></body></html>